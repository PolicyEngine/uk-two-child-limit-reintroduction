<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Inter',-apple-system,BlinkMacSystemFont,sans-serif;background:#fff;color:#333;font-size:18px;line-height:1.6;padding:8px 0}
table{width:100%;border-collapse:collapse;margin:16px 0}
th,td{padding:8px 12px;text-align:left;border-bottom:1px solid #e5e7eb}
th{font-weight:600;color:#333}
tr:nth-child(even){background:#f9fafb}
.caption{font-weight:600;margin-top:16px;margin-bottom:4px}
p{margin:16px 0}
.neg{color:#DC2626;font-weight:600}
.toggle-row{display:flex;justify-content:center;gap:16px;margin-bottom:12px}
.toggle-group{display:flex;background:#f3f4f6;border-radius:8px;padding:3px}
.toggle-btn{padding:8px 20px;border:none;background:transparent;font-size:13px;font-weight:500;color:#6B7280;cursor:pointer;border-radius:6px;transition:all .2s}
.toggle-btn:hover{background:#e5e7eb}
.toggle-btn.active{background:#6B7280;color:#fff}
.methodology-note{font-size:14px;color:#6B7280;line-height:1.6;margin:16px 0}
.methodology-note strong{color:#4B5563}
.methodology-note a{color:#4B5563;text-decoration:underline}
</style>
</head>
<body>
<div id="content"></div>
<script>
fetch('./data/poverty.csv')
.then(r=>r.text())
.then(csv=>{
  const rows=csv.trim().split('\n').slice(1).map(l=>{
    const c=l.split(',');
    return{year:c[0],measure:c[1],group:c[2],baseline:parseFloat(c[3]),reform:parseFloat(c[4]),change:parseFloat(c[5]),changePct:parseFloat(c[6]),baselineCount:parseInt(c[7]),reformCount:parseInt(c[8])}
  });
  const fmt=v=>v.toFixed(1);
  const fmtM=v=>((v)/1e6).toFixed(1)+'m';
  const years=[...new Set(rows.map(r=>r.year))];
  let selYear=years[0], selType='Relative';

  function render(){
    const filtered=rows.filter(r=>r.year===selYear&&r.measure.startsWith(selType));

    let html=`<p>Restoring the two-child limit would increase poverty rates, with the largest effect on children. We measure poverty both before housing costs (BHC) and after housing costs (AHC).</p>`;

    html+=`<p class="caption">Table 2: Change in poverty rates</p>`;

    html+=`<div class="toggle-row">`;
    html+=`<div class="toggle-group">`;
    years.forEach(y=>{html+=`<button class="toggle-btn${y===selYear?' active':''}" data-year="${y}">${y}</button>`});
    html+=`</div><div class="toggle-group">`;
    ['Absolute','Relative'].forEach(t=>{html+=`<button class="toggle-btn${t===selType?' active':''}" data-type="${t}">${t}</button>`});
    html+=`</div></div>`;
    html+=`<table><tr><th>Group</th><th>Measure</th><th>Baseline</th><th>Reform</th><th>Change (pp)</th><th>Moved into poverty</th></tr>`;
    filtered.forEach(r=>{
      const group=r.group==='Children'?'Children':'All people';
      const m=r.measure.replace(selType+' ','');
      const diff=r.reformCount-r.baselineCount;
      html+=`<tr><td>${group}</td><td>${m}</td><td>${fmt(r.baseline)}%</td><td>${fmt(r.reform)}%</td><td>+${fmt(r.change)}</td><td>+${fmtM(diff)}</td></tr>`;
    });
    html+=`</table>`;

    // Narrative paragraph
    const childBhc=rows.find(r=>r.year===years[0]&&r.measure==='Absolute BHC'&&r.group==='Children');
    const childAhc=rows.find(r=>r.year===years[0]&&r.measure==='Absolute AHC'&&r.group==='Children');
    const childAhcLast=rows.find(r=>r.year===years[years.length-1]&&r.measure==='Absolute AHC'&&r.group==='Children');
    if(childBhc){
      html+=`<p>In ${years[0]}, absolute child poverty before housing costs (BHC) would increase by ${fmt(childBhc.change)} percentage points, moving an additional ${fmtM(childBhc.reformCount-childBhc.baselineCount)} children into absolute BHC poverty.`;
      if(childAhc) html+=` Absolute child poverty after housing costs (AHC) would increase by ${fmt(childAhc.change)} percentage points, moving an additional ${fmtM(childAhc.reformCount-childAhc.baselineCount)} children into absolute AHC poverty.`;
      if(childAhcLast&&years.length>1) html+=` By ${years[years.length-1]}, the absolute AHC child poverty increase grows to ${fmt(childAhcLast.change)} percentage points (${fmtM(childAhcLast.reformCount-childAhcLast.baselineCount)} additional children).`;
      html+=`</p>`;
    }

    // Methodology note
    html+=`<p class="methodology-note"><strong>Note on baseline poverty rates:</strong> Our baseline absolute child poverty rate before housing costs (BHC) is lower than the <a href="https://www.gov.uk/government/publications/low-income-poverty-projections-for-children-fye-2025-to-fye-2031-february-2026/low-income-poverty-projections-for-children-fye-2025-to-fye-2031-february-2026" target="_blank" rel="noopener noreferrer">DWP\u2019s official figure</a>. This gap arises because our modelled incomes are higher than the DWP\u2019s at the bottom of the distribution, and as the absolute poverty line falls in this part of the income scale, even a modest overestimation moves a large share of children above the threshold. Similarly, the <a href="https://www.resolutionfoundation.org/app/uploads/2018/07/Living-Standards-Audit-2018-3.pdf" target="_blank" rel="noopener noreferrer">Resolution Foundation\u2019s Living Standards Audit 2018</a> (p.\u00a084) found their adjusted child poverty estimates to be around 6 percentage points below the DWP\u2019s official figures.</p>`;

    document.getElementById('content').innerHTML=html;
    document.querySelectorAll('[data-year]').forEach(b=>b.onclick=()=>{selYear=b.dataset.year;render()});
    document.querySelectorAll('[data-type]').forEach(b=>b.onclick=()=>{selType=b.dataset.type;render()});
  }
  render();
});
</script>
</body>
</html>
